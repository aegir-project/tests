version: '2'

services:

  hostmaster:
    image: aegir/hostmaster
    ports:
      - 80:80
    hostname: aegir.local.computer
    links:
      - database
    depends_on:
      - database
    entrypoint:
    # See https://github.com/aegir-project/dockerfiles/blob/master/docker-entrypoint-tests.sh
      - docker-entrypoint-tests.sh
    environment:
      VIRTUAL_HOST: aegir.local.computer
      MYSQL_ROOT_PASSWORD: strongpassword
      AEGIR_MAKEFILE: /var/aegir/tests/travis/build-hostmaster-local.make
    tty: true
    stdin_open: true
    volumes:
      - ../:/var/aegir/tests
      - /home/travis/build/aegir-project/hostmaster:/source/hostmaster
      - /home/travis/build/aegir-project/hosting:/source/hosting
      - /home/travis/build/aegir-project/provision:/var/aegir/.drush/commands/provision

      # Project code Volumes.
      # Individual projects need to copy their codebase into source/modules, source/themes or source/drush to be included in the images.
      - /home/travis/build/aegir-project/source/modules:/var/aegir/hostmaster-7.x-3.x/profiles/hostmaster/modules/source
      - /home/travis/build/aegir-project/source/themes:/var/aegir/hostmaster-7.x-3.x/profiles/hostmaster/themes/source
      - /home/travis/build/aegir-project/source/drush:/var/aegir/.drush/source

  database:
    image: mariadb

    # Disable logging for this container, for testing environment.
    logging:
      driver: "none"
    environment:
      MYSQL_ROOT_PASSWORD: strongpassword
